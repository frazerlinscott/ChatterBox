{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component } from '@angular/core';\nimport { HttpHeaders } from '@angular/common/http';\nconst BACKEND_URL = \"http://localhost:3000\";\nconst httpOptions = {\n  headers: new HttpHeaders({\n    'Content-Type': 'application/json'\n  })\n};\nexport let ChatComponent = class ChatComponent {\n  constructor(http, socketService, router, route) {\n    this.http = http;\n    this.router = router;\n    this.route = route;\n    this.messagecontent = \"\";\n    this.currentChannel = null;\n    this.messages = [];\n  }\n  ngOnInit() {\n    const storedUser = window.sessionStorage.getItem('current.user');\n    if (storedUser) {\n      this.loggedInUser = JSON.parse(storedUser);\n      //console.log(this.loggedInUser.username)\n    }\n\n    this.route.queryParams.subscribe(params => {\n      this.channel = params['yourKey'];\n      this.initIoConnection();\n      this.socketService.join(this.channel);\n      this.messages = []; // Clear the previous messages when changing the channel.\n    });\n  }\n\n  initIoConnection() {\n    this.socketService.initSocket();\n    this.ioConnection = this.socketService.getMessage().subscribe(data => {\n      console.log('Received:', data);\n      if (data.channel === this.channel) {\n        this.messages.push(data);\n        console.log(this.messages);\n        this.http.post(BACKEND_URL + \"/messages\", this.messages).subscribe(response => {\n          console.log('User details updated on the server.', response);\n          //refesh User list \n          this.getGroups();\n        }, error => {\n          console.error('There was an error updating the user details on the server.', error);\n          alert('Error updating profile. Please try again.');\n        });\n      }\n    });\n  }\n  sendMessage() {\n    console.log('Sending:', this.messagecontent); // Add this line\n    if (this.messagecontent) {\n      this.socketService.send(this.messagecontent, this.channel);\n      this.messagecontent = \"\";\n    }\n  }\n};\nChatComponent = __decorate([Component({\n  selector: 'app-chat',\n  templateUrl: './chat.component.html',\n  styleUrls: ['./chat.component.css']\n})], ChatComponent);","map":{"version":3,"names":["Component","HttpHeaders","BACKEND_URL","httpOptions","headers","ChatComponent","constructor","http","socketService","router","route","messagecontent","currentChannel","messages","ngOnInit","storedUser","window","sessionStorage","getItem","loggedInUser","JSON","parse","queryParams","subscribe","params","channel","initIoConnection","join","initSocket","ioConnection","getMessage","data","console","log","push","post","response","getGroups","error","alert","sendMessage","send","__decorate","selector","templateUrl","styleUrls"],"sources":["/Users/frazerlinscott/Desktop/Software Frameworks/Assignments/Assignment1_SoftwareFrames_s2930588/src/app/chat/chat.component.ts"],"sourcesContent":["import { Component, OnInit, } from '@angular/core';\nimport { ActivatedRoute, Router } from '@angular/router';\nimport {SocketService} from 'src/app/service/socket.service';\nimport { HttpClient, HttpHeaders } from '@angular/common/http';\nimport {FormsModule} from '@angular/forms';\nimport { Message } from 'server/models/messageModel';\n\nconst BACKEND_URL = \"http://localhost:3000\";\n\nconst httpOptions = {\n  headers: new HttpHeaders({ 'Content-Type': 'application/json' })\n};\n\n@Component({\n  selector: 'app-chat',\n  templateUrl: './chat.component.html',\n  styleUrls: ['./chat.component.css']\n})\n\n\nexport class ChatComponent implements OnInit {\n\n  messagecontent: string=\"\";\n  //messages: string[] = [];\n  ioConnection:any;\n  channel: any;\n  currentChannel: string | null = null;\n  loggedInUser : any;\n  messages: Message[] = [];\n\n  constructor (private http: HttpClientprivate socketService: SocketService, private router: Router, private route: ActivatedRoute) { }\n\n  ngOnInit(): void {\n\n    const storedUser = window.sessionStorage.getItem('current.user');\n    if (storedUser) {\n\n      this.loggedInUser = JSON.parse(storedUser);\n      //console.log(this.loggedInUser.username)\n    }\n    this.route.queryParams.subscribe(params => {\n        this.channel = params['yourKey'];\n        this.initIoConnection();\n        this.socketService.join(this.channel);\n        this.messages = []; // Clear the previous messages when changing the channel.\n    });\n}\n\n\n  initIoConnection() {\n    this.socketService.initSocket();\n    this.ioConnection = this.socketService.getMessage().subscribe((data: any) => {\n      console.log('Received:', data);\n      if (data.channel === this.channel) {\n        this.messages.push(data as Message);\n        console.log(this.messages); \n\n        this.http.post(BACKEND_URL+\"/messages\", this.messages).subscribe(\n          response => {\n              console.log('User details updated on the server.', response);\n\n              //refesh User list \n              this.getGroups();\n          },\n          error => {\n              console.error('There was an error updating the user details on the server.', error);\n              alert('Error updating profile. Please try again.');\n          }\n        )\n\n      }\n    });\n    \n  }\n\n    sendMessage() {\n      console.log('Sending:', this.messagecontent); // Add this line\n      if (this.messagecontent) {\n          this.socketService.send(this.messagecontent, this.channel);\n          this.messagecontent = \"\";\n      }\n    }\n\n\n}"],"mappings":";AAAA,SAASA,SAAS,QAAiB,eAAe;AAGlD,SAAqBC,WAAW,QAAQ,sBAAsB;AAI9D,MAAMC,WAAW,GAAG,uBAAuB;AAE3C,MAAMC,WAAW,GAAG;EAClBC,OAAO,EAAE,IAAIH,WAAW,CAAC;IAAE,cAAc,EAAE;EAAkB,CAAE;CAChE;AASM,WAAMI,aAAa,GAAnB,MAAMA,aAAa;EAUxBC,YAAqBC,IAAuB,EAACC,aAA4B,EAAUC,MAAc,EAAUC,KAAqB;IAA3G,KAAAH,IAAI,GAAJA,IAAI;IAA0D,KAAAE,MAAM,GAANA,MAAM;IAAkB,KAAAC,KAAK,GAALA,KAAK;IARhH,KAAAC,cAAc,GAAS,EAAE;IAIzB,KAAAC,cAAc,GAAkB,IAAI;IAEpC,KAAAC,QAAQ,GAAc,EAAE;EAE4G;EAEpIC,QAAQA,CAAA;IAEN,MAAMC,UAAU,GAAGC,MAAM,CAACC,cAAc,CAACC,OAAO,CAAC,cAAc,CAAC;IAChE,IAAIH,UAAU,EAAE;MAEd,IAAI,CAACI,YAAY,GAAGC,IAAI,CAACC,KAAK,CAACN,UAAU,CAAC;MAC1C;;;IAEF,IAAI,CAACL,KAAK,CAACY,WAAW,CAACC,SAAS,CAACC,MAAM,IAAG;MACtC,IAAI,CAACC,OAAO,GAAGD,MAAM,CAAC,SAAS,CAAC;MAChC,IAAI,CAACE,gBAAgB,EAAE;MACvB,IAAI,CAAClB,aAAa,CAACmB,IAAI,CAAC,IAAI,CAACF,OAAO,CAAC;MACrC,IAAI,CAACZ,QAAQ,GAAG,EAAE,CAAC,CAAC;IACxB,CAAC,CAAC;EACN;;EAGEa,gBAAgBA,CAAA;IACd,IAAI,CAAClB,aAAa,CAACoB,UAAU,EAAE;IAC/B,IAAI,CAACC,YAAY,GAAG,IAAI,CAACrB,aAAa,CAACsB,UAAU,EAAE,CAACP,SAAS,CAAEQ,IAAS,IAAI;MAC1EC,OAAO,CAACC,GAAG,CAAC,WAAW,EAAEF,IAAI,CAAC;MAC9B,IAAIA,IAAI,CAACN,OAAO,KAAK,IAAI,CAACA,OAAO,EAAE;QACjC,IAAI,CAACZ,QAAQ,CAACqB,IAAI,CAACH,IAAe,CAAC;QACnCC,OAAO,CAACC,GAAG,CAAC,IAAI,CAACpB,QAAQ,CAAC;QAE1B,IAAI,CAACN,IAAI,CAAC4B,IAAI,CAACjC,WAAW,GAAC,WAAW,EAAE,IAAI,CAACW,QAAQ,CAAC,CAACU,SAAS,CAC9Da,QAAQ,IAAG;UACPJ,OAAO,CAACC,GAAG,CAAC,qCAAqC,EAAEG,QAAQ,CAAC;UAE5D;UACA,IAAI,CAACC,SAAS,EAAE;QACpB,CAAC,EACDC,KAAK,IAAG;UACJN,OAAO,CAACM,KAAK,CAAC,6DAA6D,EAAEA,KAAK,CAAC;UACnFC,KAAK,CAAC,2CAA2C,CAAC;QACtD,CAAC,CACF;;IAGL,CAAC,CAAC;EAEJ;EAEEC,WAAWA,CAAA;IACTR,OAAO,CAACC,GAAG,CAAC,UAAU,EAAE,IAAI,CAACtB,cAAc,CAAC,CAAC,CAAC;IAC9C,IAAI,IAAI,CAACA,cAAc,EAAE;MACrB,IAAI,CAACH,aAAa,CAACiC,IAAI,CAAC,IAAI,CAAC9B,cAAc,EAAE,IAAI,CAACc,OAAO,CAAC;MAC1D,IAAI,CAACd,cAAc,GAAG,EAAE;;EAE9B;CAGH;AAhEYN,aAAa,GAAAqC,UAAA,EAPzB1C,SAAS,CAAC;EACT2C,QAAQ,EAAE,UAAU;EACpBC,WAAW,EAAE,uBAAuB;EACpCC,SAAS,EAAE,CAAC,sBAAsB;CACnC,CAAC,C,EAGWxC,aAAa,CAgEzB"},"metadata":{},"sourceType":"module","externalDependencies":[]}